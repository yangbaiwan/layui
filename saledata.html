<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <title>CRM管理系统</title>
    <link rel="icon" href="__PUBLIC__/img/favicon.ico" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=0"
        name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css" />
    <link rel="stylesheet" href="__PUBLIC__/css/admin.css" />
    <link rel="stylesheet" type="text/css" media="screen and (max-width:992px)" href="__PUBLIC__/css/admin.mobile.css">
    <link rel="stylesheet" href="__PUBLIC__/css/index.css">
    <style>
        .lineheight {
            line-height: 66px;
        }

        .iconPosi {
            /* position: absolute;
            top: 50%;
            margin-top: -19px;
            vertical-align: bottom; */
        }

        .imgStyle {
            width: 20px;
            position: absolute;
            top: -5px;
            right: -10px;
        }

        .content-search {
            border-bottom: 0;
        }

        .layui-table-cell {
            height: auto !important;
        }

        .divNone {
            display: none;
        }

        .divHide {
            visibility: hidden;
        }

        @media screen and (max-width: 992px) {
            .img_box {
                position: relative;

                height: 60px;
            }

            .timeSear,
            .iconPosi {
                margin-top: 11px;
            }

            .img_con {
                position: absolute;
                left: 50%;
                display: inline-block;
                width: auto;
                margin-left: -50px !important;
            }
        }
    </style>
</head>

<body>
    <!-- 布局容器 -->
    <div class="layui-layout layui-layout-admin">
        <input type="hidden" id="urlOgin" value="{:U('Login/loginSign')}">
        <input type="hidden" id="menu" value="{:U('Index/indexShow')}">

        <!-- 头部 -->
        <div id="header">
            <header-component></header-component>
        </div>

        <!-- 遮罩层 -->
        <div class="masked"></div>

        <!-- 左侧菜单 -->
        <div id="leftSlide">
            <leftslide-component></leftslide-component>
        </div>

        <!-- 主体 -->
        <div class="layui-body">
            <!-- 主要内容 -->
            <div class="container">
                <div class="nav-sty">
                    <span class="layui-breadcrumb">
                        <a href="javascript:;">中层审核端展示</a>
                        <a href="javascript:;">销售数据</a>
                    </span>
                </div>
                <!-- 搜索条件 -->
                <div class="search-res-mask"></div>
                <div class="search-res">
                    <div class="search-res-btn hide-pc">
                        <button class="layui-btn" id="search-btn"><i class="layui-icon">&#xe615;</i>查询</button>
                    </div>
                    <div class="content-search search-fix" style="border: 0;">
                        <div class="layui-form layui-form-pane layui-row" style="line-height: 60px;">
                            <div class="layui-inline layui-col-xs12 layui-col-sm6 layui-col-md2 img_box">
                                <div class="layui-input-inline img_con">
                                    <img class="img-cp fl mr10 weixintouxiang" src="__PUBLIC__/img/default.png" alt="">
                                    <span class="adminname"></span>
                                </div>
                            </div>
                            <div class="layui-inline layui-col-xs12 layui-col-sm3 layui-col-md3">
                                <div class="layui-input-inline newlayui-input-inline" style="width: auto;">
                                    <input type="text" name="title" id="iphone" required lay-verify="required"
                                        placeholder="请输入手机号" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-input-inline newlayui-input-inline"
                                    style="position: relative;margin-left: -3px;width: auto;">
                                    <button class="layui-btn iconPosi">
                                        <i class="layui-icon layui-icon-search"></i>查询
                                    </button>

                                </div>
                            </div>
                            <div class="layui-inline layui-col-xs12 layui-col-sm3 layui-col-md6">
                                <div class="layui-input-inline newlayui-input-inline" style="width: auto;">
                                    <input type="text" name="title" id="timeOne" required lay-verify="required"
                                        placeholder="请输入时间" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-input-inline newlayui-input-inline"
                                    style="width: 21px; text-align: center;">
                                    ~</div>
                                <div class="layui-input-inline newlayui-input-inline" style="width: auto;">
                                    <input type="text" name="title" id="timeTwe" required lay-verify="required"
                                        placeholder="请输入时间" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-input-inline newlayui-input-inline"
                                    style="position: relative;margin-left: -3px;width: auto;">
                                    <button class="layui-btn timeSear">
                                        <i class="layui-icon layui-icon-search"></i>查询
                                    </button>

                                </div>
                            </div>
                            <div class="layui-inline layui-col-xs12 layui-col-sm6 layui-col-md1">
                                <button onclick="window.location.href='ranking.html'"
                                    class="layui-btn layui-btn-fluid layui-btn-primary"
                                    style="width: auto;position: relative;">权限分配</button>

                            </div>

                            <div class="layui-inline  layui-col-xs12">
                                <!-- <button class="layui-btn" lay-submit="">查询</button> -->
                                <button class="layui-btn layui-btn-primary hide-pc" id="search-close">关闭</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="" style="line-height: 40px;">
                    <div class="layui-row">
                        <div class="layui-col-xs6 layui-col-sm2 layui-col-md2 addChangeNumBox">
                            <label class="">今日新增人数</label>
                            <span class="bangJinNum">10</span>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm2 layui-col-md2 alreadyChangeBox">
                            <label class="">新增转化总人数</label>
                            <span class="chengJinNum">10</span>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm2 layui-col-md2 converBox">
                            <label class="">已转化总人数</label>
                            <span class="chengNum">10</span>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm2 layui-col-md4 addNumBox">
                            <label class="">平均转化率</label>
                            <span class="zongChengLv">10</span>
                        </div>
                        <div class="layui-col-xs12 layui-col-sm4 layui-col-md2 layui-form" style="">
                            <select name="screen" id="screen" lay-filter="screen">
                                <option value="">筛选</option>
                                <option value="0">转化率低于10%</option>
                                <option value="1">转化率高于10%</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="table-list">
                    <table class="layui-table layui-list-table" lay-skin="line" id="test" lay-filter="test"></table>
                </div>

            </div>
        </div>
    </div>
    <!-- 可不引入 -->
    <script type="text/javascript" src="__PUBLIC__/js/vue.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/layui/layui.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/fastclick.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/admin.js"></script>
    <script>
        layui.use(['jquery', 'form', 'laydate', 'table', 'layer', 'laypage', 'element'], function () {
            var $ = layui.jquery,
                laydate = layui.laydate,
                layer = layui.layer,
                form = layui.form,
                table = layui.table,
                laypage = layui.laypage,
                element = layui.element;
            $(function () {
                FastClick.attach(document.body);
            });
            dataShow();

            function dataShow(phone, value, time, timeEnd) {
                table.render({
                    elem: '#test',
                    url: "{:U('Middle/middleShow')}",
                    method: 'POST',
                    limits: [30],
                    limit: 30,
                    where: {
                        phone: phone || '',
                        time: time || '',
                        timeEnd: timeEnd || ''
                    },
                    parseData: function (res) {
                        console.log(res);
                        if (value && phone == '') {
                            if (value == 1) {
                                for (var i = 0; i < res.data.length; i++) {
                                    if (res.data[i].zhuanLv > '10%') {
                                        res.data.splice(i, 1);
                                    }

                                }
                            } else if (value == 2) {
                                for (var i = 0; i < res.data.length; i++) {
                                    if (res.data[i].zhuanLv < '10%') {
                                        res.data.splice(i, 1);
                                    }

                                }
                            }

                        }

                        console.log(res.data);
                        return {
                            'code': 0,
                            'data': res.data,
                            'count': res.count,
                            'bangJinNum': res.bangJinNum,
                            'chengJinNum': res.chengJinNum,
                            'chengNum': res.chengNum,
                            'zongChengLv': res.zongChengLv,
                            'admin': res.admin
                        }
                    },
                    page: {
                        //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                        layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'],
                        groups: 1,
                        first: false,
                        last: false //不显示尾页

                    },
                    cols: [
                        [{
                                field: 'weixintouxiang',
                                // width: 80,
                                title: '用户头像',
                                templet: '<div style="height:auto!important;width:86px!important"><img style="width: 30%;" src="{{ d.weixintouxiang}}"></div>',
                                align: 'center',
                                minWidth: 120
                            },
                            {
                                field: 'adminname',
                                title: '销售昵称',
                                align: 'center',
                                minWidth: 120
                            },
                            {
                                field: 'admindate',
                                // width: 80,
                                title: '加入日期',
                                align: 'center',
                                minWidth: 120,
                                templet: function (data) {
                                    return data.admindate ? data.admindate.split(' ')[0] : ''
                                }
                            },
                            {
                                field: 'bangNum',
                                // width: 80,
                                title: '绑定人数',
                                align: 'center',
                                minWidth: 120
                            },
                            {
                                field: 'chengNum',
                                // width: 80,
                                title: '成单人数',
                                align: 'center',
                                minWidth: 120
                            },
                            {
                                field: 'zhuanLv',
                                title: '转化率',
                                align: 'center',
                                minWidth: 120
                            },
                            {
                                field: 'anQuanNum',
                                title: '安全期人数',
                                align: 'center',
                                minWidth: 120
                            }, {
                                field: 'adminphone',
                                align: 'center',
                                minWidth: 120,
                                title: '手机号',
                                templet: function (res) {
                                    return res.adminphone.substring(0, 3) + '****' + res
                                        .adminphone.substring(3, 7);
                                },
                                event: 'edit'
                            },
                            {
                                field: 'adminstate',
                                title: '状态',
                                templet: function (d) {
                                    if (d.adminstate == 0) {
                                        return '未通过审核'
                                    } else if (d.adminstate == 1) {
                                        return '通过审核'
                                    }
                                },
                                align: 'center',
                                minWidth: 120
                            }
                        ]
                    ],
                    page: true,
                    done: function (res, curr, count) {
                        //如果是异步请求数据方式，res即为你接口返回的信息。
                        //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                        console.log(res);
                        $('.bangJinNum').text(res.bangJinNum);
                        $('.chengJinNum').text(res.chengJinNum);
                        $('.chengNum').text(res.chengNum);
                        $('.zongChengLv').text(res.zongChengLv);
                        //得到当前页码
                        $('.weixintouxiang').attr('src', res.admin.weixintouxiang)
                        $('.adminname').text(res.admin.adminname)
                    }
                });

            }

            $('.iconPosi').on('click', function () {
                var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
                var iphone = $('#iphone').val();
                if (myreg.test(iphone)) {

                    dataShow(iphone);
                    if (parseInt(window.screen.width) < 768) {
                        $('.addNumBox').addClass('divNone')
                        $('.addChangeNumBox').addClass('divNone')
                        $('.alreadyChangeBox').addClass('divNone')
                        $('.converBox').addClass('divNone')
                        $('.addNumBox').removeClass('divHide')
                        $('.addChangeNumBox').removeClass('divHide')
                        $('.alreadyChangeBox').removeClass('divHide')
                        $('.converBox').removeClass('divHide')
                    } else {
                        $('.addNumBox').removeClass('divNone')
                        $('.addChangeNumBox').removeClass('divNone')
                        $('.alreadyChangeBox').removeClass('divNone')
                        $('.converBox').removeClass('divNone')
                        $('.addNumBox').addClass('divHide')
                        $('.addChangeNumBox').addClass('divHide')
                        $('.alreadyChangeBox').addClass('divHide')
                        $('.converBox').addClass('divHide')
                    }

                } else {
                    layer.msg('请输入正确的手机号')
                }
            })

            //
            form.on('select(screen)', function (res) {
                $('#iphone').val('')
                dataShow('', res.value)
                if (parseInt(window.screen.width) < 768) {
                    $('.addNumBox').addClass('divNone')
                    $('.addChangeNumBox').addClass('divNone')
                    $('.alreadyChangeBox').addClass('divNone')
                    $('.converBox').addClass('divNone')
                    $('.addNumBox').removeClass('divHide')
                    $('.addChangeNumBox').removeClass('divHide')
                    $('.alreadyChangeBox').removeClass('divHide')
                    $('.converBox').removeClass('divHide')
                } else {
                    $('.addNumBox').removeClass('divNone')
                    $('.addChangeNumBox').removeClass('divNone')
                    $('.alreadyChangeBox').removeClass('divNone')
                    $('.converBox').removeClass('divNone')
                    $('.addNumBox').addClass('divHide')
                    $('.addChangeNumBox').addClass('divHide')
                    $('.alreadyChangeBox').addClass('divHide')
                    $('.converBox').addClass('divHide')
                }
            })

            //显示手机号
            table.on('tool(test)', function (obj) {
                var data = obj.data;
                if (obj.event === 'edit') {
                    if ($(this).children().text().substr(3, 1) == '*') {
                        $(this).children().text(data.adminphone)
                        $(this).parent().siblings().map(function (i, val, arr) {
                            if (val.childNodes[5].children[0].innerText.length == 11 && val
                                .childNodes[5].children[0].innerText.substr(3, 1) != '*') {
                                val.childNodes[5].children[0].innerText = val.childNodes[5]
                                    .dataset
                                    .content.substring(0, 3) + '****' +
                                    val.childNodes[5].dataset.content.substring(7, 12);
                            } else {

                            }

                        })

                    } else {
                        if (data.adminphone != '' && data.adminphone != null) {
                            $(this).children().text(data.adminphone.substring(0, 3) + '****' + data
                                .adminphone
                                .substring(7, 12));

                        }

                    }

                }

            })

            laydate.render({
                elem: "#timeOne", //指定元素
                done: function (value, date) {
                    // dataChange(value);
                }
            });
            laydate.render({
                elem: "#timeTwe", //指定元素
                done: function (value, date) {
                    // dataChange(value);
                }
            });
            $('.timeSear').on('click', function () {
                var timeReg = /^[1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/
                if (timeReg.test($('#timeOne').val()) && timeReg.test($('#timeTwe').val())) {
                    dataShow('', '', $('#timeOne').val(), $('#timeTwe').val())
                } else {
                    layer.msg('请输入正确的时间格式，如‘2012-01-01’')
                }
            })
            //判断是否成单
            $(document).on('click', '#check', function () {
                console.log(1);
            })
            layui.form.on('checkbox', function (data) {
                console.log(data.elem); //得到checkbox原始DOM对象
                console.log(data.elem.checked); //是否被选中，true或者false
                console.log(data.value); //复选框value值，也可以通过data.elem.value得到
                console.log(data.othis); //得到美化后的DOM对象
                if (data.elem.checked === true) {
                    layer.open({
                        title: '请输入此成单用户的手机号',
                        content: '<div class="layui-input-inline"><input type="text" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input"></div>'
                    });
                }
            });



        });
    </script>
</body>

</html>